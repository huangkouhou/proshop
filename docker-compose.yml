version: '3.8'

services:
  # åç«¯æœåŠ¡
  backend:
    image: ${DOCKER_USERNAME}/my-node-app:latest
    restart: always
# è¿™å‘Šè¯‰ Dockerï¼šç›´æ¥è¯»å– .env æ–‡ä»¶é‡Œçš„æ‰€æœ‰å˜é‡æ³¨å…¥ç»™å®¹å™¨
    env_file:
      - .env
    deploy:
      resources:
        limits:
          memory: 300M  # é™åˆ¶å†…å­˜ï¼
    networks:
      - app-net

  # å‰ç«¯ + Caddy æœåŠ¡
  web:
    image: ${DOCKER_USERNAME}/my-react-caddy:latest
    restart: always
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - backend
    # æŠŠè¯ä¹¦æ•°æ®æŒ‚è½½å‡ºæ¥ ğŸ‘‡ğŸ‘‡ğŸ‘‡
    volumes:
      - caddy_data:/data
      - caddy_config:/config
    deploy:
      resources:
        limits:
          memory: 150M  # Caddy å¾ˆçœå†…å­˜
    networks:
      - app-net

networks:
  app-net:
    driver: bridge

volumes:
  caddy_data:
  caddy_config: